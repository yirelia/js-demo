<div id="container" style="height: 100vh; width: 100vw;"></div>

<script type="importmap">
  {
    "imports": {
      "three": "../../static/js/three/163/three.module.js",
      "three/addons/": "../../static/js/three/jsm/"
    }
  }
</script>

<script type="module">
    import * as THREE from "three";
    import Stats from "three/addons/libs/stats.module.js";
    import { OrbitControls } from "three/addons/controls/OrbitControls.js";
    import { OBJLoader } from "three/addons/loaders/OBJLoader.js";
    import { GUI } from 'three/addons/libs/lil-gui.module.min.js';


    const gui = new GUI();
    const stats = new Stats();
    container.appendChild(stats.dom);
    // 渲染器
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);
    container.appendChild(renderer.domElement);
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xeef2f7); 
    //---------------------------- 坐标轴辅助线 ---------------------------
    const axesHelper = new THREE.AxesHelper(5); // 参数为坐标轴的大小
    scene.add(axesHelper);


    const camera = new THREE.PerspectiveCamera(100, window.innerWidth / window.innerHeight, 1, 100);
    camera.position.set(100, 100, 100);
    // --------------------------- 环境光 和点光源 ---------------------------
    const ambientLight = new THREE.AmbientLight(0xffffff, 1); // 环境光，颜色和强度
    scene.add(ambientLight);
    // 太阳光（主光源）
    const sun = new THREE.DirectionalLight(0xffffff, 1.2);
    sun.position.set(8, 12, 6);     // 调高一些让阴影更自然
    sun.castShadow = true;
    sun.shadow.mapSize.set(2048, 2048);
    sun.shadow.camera.near = 0.5;
    sun.shadow.camera.far = 50;
    sun.shadow.camera.left = -15;
    sun.shadow.camera.right = 15;
    sun.shadow.camera.top = 15;
    sun.shadow.camera.bottom = -15;
    scene.add(sun);

    const pointHelpler = new THREE.DirectionalLight(sun, 1); // 点光源辅助工具，参数为点光源和辅助工具的大小
    scene.add(pointHelpler);
    const lightFolder = gui.addFolder('sun Light');
    const lightPosition = {
        x: sun.position.x,
        y: sun.position.y,
        z: sun.position.z
    };
    lightFolder.open();


    lightFolder.add(lightPosition, 'x', 0, 1000).onChange(value => {
        pointLight.position.x = value;
        pointHelpler.update(); // 更新灯光辅助工具
    });
    lightFolder.add(lightPosition, 'y', 0, 1000).onChange(value => {
        pointLight.position.y = value;
        pointHelpler.update();
    });
    lightFolder.add(lightPosition, 'z', 0, 1000).onChange(value => {
        pointLight.position.z = value;
        pointHelpler.update();
    });

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.target.set(0, 0.5, 0);
    controls.update();
    controls.enablePan = false;
    controls.enableDamping = true;

    // --------------------------- 模型加载 ---------------------------
    const loader = new OBJLoader();
    loader.load('/static/js/three/files/train.obj', function (gltf) {
        console.log("模型加载完成")
        const model = gltf;
        scene.add(model);
        animate();
    }, undefined, function (error) {
        console.error(error);
    });


    // 动画渲染
    function animate() {

        requestAnimationFrame(animate);

        controls.update();

        stats.update();

        renderer.render(scene, camera);

    }

</script>