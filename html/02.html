<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>router</title>
    <link rel="stylesheet" href="../css/index.css" />
    <script src="../js/x6/2.18.1/index.js"></script>
  </head>

  <body>
    <div id="app"></div>
  </body>
  <script type="module">
    class Graph {
      constructor() {}
    }

    class Point {
      constructor(x, y) {
        this.x = x;
        this.y = y;
      }

      static create(x, y) {
        return new Point(x, y);
      }

      static clone(x, y) {
        if (x instanceof Point) {
          return new Point(x.x, x.y);
        }
        return new Point(x, y);
      }
    }

    class AlgNode {
      constructor(x, y, val) {
        this.x = x;
        this.y = y;
        this.val = val;
        this.id = `node_${x}_${y}`;
      }

      visited() {
        this.val.setAttrByPath("body/fill", "red");
      }

      toBeVisited() {
        this.val.setAttrByPath("body/fill", "green");
      }
      static create(x, y, val) {
        return new AlgNode(x, y, val);
      }
    }

    class Queue {
      constructor(queue = []) {
        this.data = [...queue];
        this.size = queue.length;
      }

      push(item) {
        this.data.push(item);
        this.size++;
      }

      pop() {
        if (this.size > 0) {
          this.size--;
        }
        return this.data.shift();
      }

      isEmpty() {
        return this.size === 0;
      }
    }
    const graph = new X6.Graph({
      container: document.getElementById("app"),
      grid: true,
      background: {
        color: "#f5f5f5",
      },
      async: false,
    });
    const allNodes = [];
    const nodeMap = new Map();
    let y = 100;
    const width = 40;
    const height = 40;
    const padding = 10;
    let index = 0;
    for (let i = 0; i < 10; i++) {
      let x = 100;
      for (let j = 0; j < 10; j++) {
        const id = `node_${i}_${j}`;
        const gNode = graph.addNode({
          id,
          x: x,
          y: y,
          width,
          height,
          label: `${index}`,
          attrs: {
            body: {
              strokeWidth: 1,
            },
          },
        });
        const node = AlgNode.create(i, j, gNode);
        nodeMap.set(`node_${i}_${j}`, node);
        index++;
        x += width + padding;
      }
      y += height + padding;
    }

    console.log(nodeMap);

    const getNeighbors = (node) => {
      const dir = [
        [1, 0], // RIGHT
        [0, 1], // DOWN
        [-1, 0], // LEFT
        [0, -1], // UP
      ];
      const result = [];
      for (let i = 0; i < dir.length; i++) {
        const [dx, dy] = dir[i];
        // const neighbor = {x: node.x + dx, y: node.y + dy};
        const neighbor = nodeMap.get(`node_${node.x + dx}_${node.y + dy}`);
        if (neighbor) {
          result.push(neighbor);
        }
      }
      return result;
    };

    function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

    async function breadFirstSearch(node) {
      const queue = new Queue([node]);
      const visited = new Set();
      visited.add(node.id);
      let interval = 800

      while (!queue.isEmpty()) {
        const current = queue.pop();
        current.visited();
        const neighbors = getNeighbors(current);
        for (let i = 0; i < neighbors.length; i++) {
          const neighbor = neighbors[i];
          if (!visited.has(neighbor.id)) {
            neighbor.toBeVisited();
            queue.push(neighbor);
            visited.add(neighbor.id);
          }
        }
        await sleep(interval)
      }
    }

    const rootNode = nodeMap.get("node_5_5");
    breadFirstSearch(rootNode);
  </script>
</html>
